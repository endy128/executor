name: Build MiSTer Core

on: [push, pull_request]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      # 1. CLEANUP: Free up space for the massive Quartus image
      - name: Cleanup Disk Space
        run: |
          sudo rm -rf /usr/share/dotnet
          sudo rm -rf /opt/ghc
          sudo rm -rf "/usr/local/share/boost"
          sudo rm -rf "$AGENT_TOOLSDIRECTORY"

      # 2. THE BUILD: Using the official MiSTer GitHub Container image
      - name: Compile FPGA Core
        uses: docker://ghcr.io/mister-devel/quartus:latest
        with:
          args: |
            quartus_sh --flow compile MySoundToy

      # 3. UPLOAD: Save the .rbf file so you can download it
      - name: Upload RBF
        uses: actions/upload-artifact@v4
        with:
          name: MiSTer_SoundFX_Core
          path: |
            output_files/*.rbf
